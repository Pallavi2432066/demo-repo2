# .github/workflows/manual-ops.yml
name: Manual Ops Workflow

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'staging'

jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

  setup-docker:
    runs-on: ubuntu-latest
    needs: checkout
    steps:
      - name: Setup Docker
        run: sudo apt-get install docker.io

  build-image:
    runs-on: ubuntu-latest
    needs: setup-docker
    steps:
      - name: Build Docker image
        run: docker build -t my-app:${{ github.sha }} .

  push-image:
    runs-on: ubuntu-latest
    needs: build-image
    steps:
      - name: Push to registry
        run: docker tag my-app:${{ github.sha }} registry.example.com/my-app:${{ github.sha }}
      - name: Push image
        run: docker push registry.example.com/my-app:${{ github.sha }}

  deploy:
    runs-on: ubuntu-latest
    needs: push-image
    steps:
      - name: Deploy to ${{ github.event.inputs.environment }}
        run: echo "Deploying to ${{ github.event.inputs.environment }}"

  notify:
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - name: Send Slack notification
        uses: slackapi/slack-github-action@v1.24.0
        with:
          payload: |
            {
              "text": "Deployment to ${{ github.event.inputs.environment }} completed for commit ${{ github.sha }}"
            }
